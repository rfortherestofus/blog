---
title: "Refugees animation"
author: David Keyes
date: 1/17/2024
toc: false
format: gfm
wrap: none
knitr:
  opts_chunk:
    out.width: 100%
    fig.height: 8
    dpi: 300
    collapse: true
    comment: "#>"
    warning: false
    message: false
editor_options: 
  chunk_output_type: console
---

```{r}
# Load necessary libraries
library(tidyverse)
library(gganimate)
library(refugees)
library(viridis)
library(RColorBrewer)

population

filtered_data <-
  population |>
  group_by(year, coa_name) |>
  summarise(refugees = sum(refugees, na.rm = TRUE)) |>
  ungroup()

# Create the facetted animated plot
animated_plot <-
  ggplot(filtered_data, aes(x = year, y = refugees, color = coa_name, group = coa_name)) +
  geom_line(size = 1.2) +
  geom_point(size = 2) +
  scale_y_continuous(labels = scales::comma) +
  labs(
    title = "Evolution of Refugees per Country (Top 8)",
    x = "Year",
    y = "Number of Refugees",
    color = "Country of Asylum"
  ) +
  # Use a color-blind-friendly or aesthetically pleasing palette
  scale_color_viridis_d(option = "C") + # Alternative: scale_color_brewer(palette = "Set2")
  theme_minimal(base_size = 15) +
  theme(
    legend.position = "none", # Hide the legend in facetted plots
    plot.title = element_text(size = 20, face = "bold"),
    axis.text.x = element_text(angle = 45, hjust = 1)
  ) +
  facet_wrap(~coa_name, scales = "free_y") + # Facet by country of asylum
  transition_reveal(year)

# Save the animation as a gif
anim_save("refugees_evolution_facetted.gif", animation = animated_plot)
```
